<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Medical Chatbot Conversation Test</title>
  <link rel="stylesheet" href="/src/styles.css">
  <style>
    .test-container {
      max-width: 1000px;
      margin: 20px auto;
      padding: 20px;
      background: linear-gradient(270deg, rgb(44, 13, 58), rgb(13, 58, 56));
      border-radius: 15px;
      min-height: 100vh;
    }
    .chat-container {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .chat-header {
      background: linear-gradient(270deg, rgb(44, 13, 58), rgb(13, 58, 56));
      color: white;
      padding: 15px 20px;
      font-size: 1.2em;
      font-weight: bold;
    }
    .chat-messages {
      height: 500px;
      overflow-y: auto;
      padding: 20px;
      background: #f8f9fa;
    }
    .chat-input {
      display: flex;
      padding: 15px;
      background: white;
      border-top: 1px solid #eee;
    }
    .chat-input textarea {
      flex: 1;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 10px;
      margin-right: 10px;
      resize: none;
      font-family: inherit;
    }
    .chat-input button {
      background: linear-gradient(270deg, rgb(44, 13, 58), rgb(13, 58, 56));
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .chat-input button:hover {
      background: linear-gradient(270deg, rgb(144, 100, 18), rgb(52, 18, 8));
    }
    .test-controls {
      background: white;
      margin: 20px 0;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-button {
      background: #28a745;
      color: white;
      border: none;
      padding: 8px 15px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9em;
    }
    .test-button:hover {
      background: #218838;
    }
    .test-button.secondary {
      background: #6c757d;
    }
    .test-button.secondary:hover {
      background: #5a6268;
    }
    .status {
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
      font-weight: bold;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1 style="color: white; text-align: center; margin-bottom: 20px;">üß™ Medical Chatbot Conversation Test</h1>
    
    <div class="test-controls">
      <h3>Test Controls</h3>
      <p>Click the buttons below to simulate different conversation scenarios:</p>
      
      <button class="test-button" onclick="testScenario1()">Scenario 1: Headache Diagnosis</button>
      <button class="test-button" onclick="testScenario2()">Scenario 2: Chest Pain Assessment</button>
      <button class="test-button" onclick="testScenario3()">Scenario 3: Follow-up Questions</button>
      <button class="test-button" onclick="testScenario4()">Scenario 4: Complex Medical Response</button>
      <button class="test-button secondary" onclick="clearChat()">Clear Chat</button>
      <button class="test-button secondary" onclick="testMarkdownOnly()">Test Markdown Only</button>
      
      <div id="status" class="status info">
        Ready to test. Click a scenario button above.
      </div>
    </div>

    <div class="chat-container">
      <div class="chat-header">Medical Chatbot Doctor</div>
      <div class="chat-messages" id="chat-messages">
        <div class="message">
          <strong class="bot">DocBot:</strong><br/>
          Hi! I'm your dedicated health assistant, here to support you with all your wellness questions. Feel free to ask me any question about your health and well-being.
        </div>
      </div>
      <div class="chat-input">
        <textarea id="user-input" placeholder="Type your question here..." rows="2"></textarea>
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>
  </div>

  <!-- Include Marked.js -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  
  <script>
    // Configure Marked.js
    marked.setOptions({
      breaks: true,
      gfm: true,
      headerIds: false,
      mangle: false
    });

    // Simulate the app's message handling
    function appendMessage(role, text, isHTML = false) {
      const messagesDiv = document.getElementById('chat-messages');
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('message');
      
      const prefix = role === 'user' ? 'You' : 'DocBot';
      let content = '';
      
      if (isHTML) {
        content = `<strong class="${role}">${prefix}:</strong><br/>${text}`;
      } else {
        content = `<strong class="${role}">${prefix}:</strong> ${text}`;
      }
      
      messageDiv.innerHTML = content;
      messagesDiv.appendChild(messageDiv);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function sendMessage() {
      const input = document.getElementById('user-input');
      const message = input.value.trim();
      if (!message) return;
      
      appendMessage('user', message);
      input.value = '';
      
      // Simulate bot response
      setTimeout(() => {
        const response = generateBotResponse(message);
        const htmlResponse = marked.parse(response);
        appendMessage('bot', htmlResponse, true);
      }, 1000);
    }

    function generateBotResponse(userMessage) {
      const lowerMessage = userMessage.toLowerCase();
      
      if (lowerMessage.includes('headache')) {
        return `### **Most Likely Diagnosis**

Based on your symptoms, this appears to be a **tension headache** or **migraine**.

**Immediate Actions:**
* **Pain Management**: Take ibuprofen 400mg or acetaminophen 500mg
* **Rest**: Find a quiet, dark place to rest
* **Hydration**: Drink plenty of water
* **Monitoring**: Watch for worsening symptoms

**When to Seek Medical Attention:**
* Severe, sudden headache
* Headache with fever and stiff neck
* Headache after head injury
* Persistent headache for more than 48 hours

**Prevention Tips:**
* Maintain regular sleep schedule
* Manage stress through relaxation techniques
* Avoid known triggers (caffeine, alcohol, certain foods)
* Practice good posture and take regular breaks from screen time`;
      }
      
      if (lowerMessage.includes('chest pain')) {
        return `### **Emergency Assessment Required**

**‚ö†Ô∏è Chest pain can be a medical emergency. Please seek immediate medical attention if you experience:**

* **Severe chest pain** that feels like pressure or squeezing
* Pain that **radiates to your arm, jaw, or back**
* **Shortness of breath** or difficulty breathing
* **Nausea, dizziness, or cold sweats**

**Possible Causes:**
1. **Heart-related issues** (angina, heart attack)
2. **Lung problems** (pneumonia, pleurisy)
3. **Digestive issues** (acid reflux, GERD)
4. **Musculoskeletal problems** (costochondritis)

**Immediate Steps:**
* **Call emergency services** if symptoms are severe
* **Stop all physical activity**
* **Sit or lie down** in a comfortable position
* **Take prescribed medications** if available`;
      }
      
      if (lowerMessage.includes('clarify') || lowerMessage.includes('again')) {
        return `### **Clarification of Previous Diagnosis**

Let me clarify the **headache diagnosis** I mentioned earlier:

**Tension Headache Characteristics:**
* **Location**: Usually both sides of the head
* **Intensity**: Mild to moderate pressure
* **Duration**: 30 minutes to several hours
* **Triggers**: Stress, poor posture, lack of sleep

**Treatment Recommendations:**
* **Over-the-counter pain relievers**: Ibuprofen or acetaminophen
* **Lifestyle modifications**: Stress management, regular sleep
* **Physical therapy**: For posture-related issues

**When to Reconsider Diagnosis:**
* If pain becomes severe or one-sided
* If accompanied by visual disturbances
* If pain persists despite treatment`;
      }
      
      if (lowerMessage.includes('medication') || lowerMessage.includes('dosage')) {
        return `### **Medication Guidelines**

**Ibuprofen Dosage:**
* **Adults**: 200-400mg every 4-6 hours as needed
* **Maximum**: 1200mg in 24 hours
* **Take with food** to minimize stomach upset

**Acetaminophen Dosage:**
* **Adults**: 500-1000mg every 4-6 hours as needed
* **Maximum**: 4000mg in 24 hours
* **Safe for most people**, including those with stomach issues

**Important Precautions:**
* **Do not exceed** recommended dosages
* **Avoid alcohol** while taking these medications
* **Consult your doctor** if you have liver or kidney problems
* **Stop taking** if you experience side effects`;
      }
      
      return `### **General Health Assessment**

I understand you're asking about "${userMessage}". 

**Recommendations:**
* **Consult with a healthcare provider** for personalized advice
* **Monitor your symptoms** and keep a health diary
* **Maintain a healthy lifestyle** with proper diet and exercise
* **Seek emergency care** if symptoms are severe or concerning

**Remember**: This is general information and should not replace professional medical advice.`;
    }

    // Test Scenarios
    function testScenario1() {
      clearChat();
      updateStatus('Testing Scenario 1: Headache Diagnosis', 'info');
      
      setTimeout(() => {
        appendMessage('user', 'I have a severe headache that started yesterday');
        setTimeout(() => {
          const response = `### **Most Likely Diagnosis**

Based on your symptoms, this appears to be a **tension headache** or **migraine**.

**Immediate Actions:**
* **Pain Management**: Take ibuprofen 400mg or acetaminophen 500mg
* **Rest**: Find a quiet, dark place to rest
* **Hydration**: Drink plenty of water
* **Monitoring**: Watch for worsening symptoms

**When to Seek Medical Attention:**
* Severe, sudden headache
* Headache with fever and stiff neck
* Headache after head injury
* Persistent headache for more than 48 hours

**Prevention Tips:**
* Maintain regular sleep schedule
* Manage stress through relaxation techniques
* Avoid known triggers (caffeine, alcohol, certain foods)
* Practice good posture and take regular breaks from screen time`;
          
          const htmlResponse = marked.parse(response);
          appendMessage('bot', htmlResponse, true);
          updateStatus('‚úÖ Scenario 1 completed - Check markdown rendering', 'success');
        }, 1000);
      }, 500);
    }

    function testScenario2() {
      clearChat();
      updateStatus('Testing Scenario 2: Chest Pain Assessment', 'info');
      
      setTimeout(() => {
        appendMessage('user', 'I\'m experiencing chest pain');
        setTimeout(() => {
          const response = `### **Emergency Assessment Required**

**‚ö†Ô∏è Chest pain can be a medical emergency. Please seek immediate medical attention if you experience:**

* **Severe chest pain** that feels like pressure or squeezing
* Pain that **radiates to your arm, jaw, or back**
* **Shortness of breath** or difficulty breathing
* **Nausea, dizziness, or cold sweats**

**Possible Causes:**
1. **Heart-related issues** (angina, heart attack)
2. **Lung problems** (pneumonia, pleurisy)
3. **Digestive issues** (acid reflux, GERD)
4. **Musculoskeletal problems** (costochondritis)

**Immediate Steps:**
* **Call emergency services** if symptoms are severe
* **Stop all physical activity**
* **Sit or lie down** in a comfortable position
* **Take prescribed medications** if available`;
          
          const htmlResponse = marked.parse(response);
          appendMessage('bot', htmlResponse, true);
          updateStatus('‚úÖ Scenario 2 completed - Check emergency formatting', 'success');
        }, 1000);
      }, 500);
    }

    function testScenario3() {
      clearChat();
      updateStatus('Testing Scenario 3: Follow-up Questions', 'info');
      
      setTimeout(() => {
        appendMessage('user', 'I have a headache');
        setTimeout(() => {
          const response1 = `### **Most Likely Diagnosis**

This appears to be a **tension headache**. 

**Immediate Actions:**
* Take ibuprofen 400mg
* Rest in a quiet environment
* Stay hydrated`;
          
          const htmlResponse1 = marked.parse(response1);
          appendMessage('bot', htmlResponse1, true);
          
          setTimeout(() => {
            appendMessage('user', 'Can you clarify the dosage again?');
            setTimeout(() => {
              const response2 = `### **Clarification of Previous Diagnosis**

Let me clarify the **headache diagnosis** I mentioned earlier:

**Tension Headache Characteristics:**
* **Location**: Usually both sides of the head
* **Intensity**: Mild to moderate pressure
* **Duration**: 30 minutes to several hours
* **Triggers**: Stress, poor posture, lack of sleep

**Treatment Recommendations:**
* **Over-the-counter pain relievers**: Ibuprofen or acetaminophen
* **Lifestyle modifications**: Stress management, regular sleep
* **Physical therapy**: For posture-related issues`;
              
              const htmlResponse2 = marked.parse(response2);
              appendMessage('bot', htmlResponse2, true);
              updateStatus('‚úÖ Scenario 3 completed - Check follow-up conversation', 'success');
            }, 1000);
          }, 2000);
        }, 1000);
      }, 500);
    }

    function testScenario4() {
      clearChat();
      updateStatus('Testing Scenario 4: Complex Medical Response', 'info');
      
      setTimeout(() => {
        appendMessage('user', 'What medication should I take for my headache?');
        setTimeout(() => {
          const response = `### **Medication Guidelines**

**Ibuprofen Dosage:**
* **Adults**: 200-400mg every 4-6 hours as needed
* **Maximum**: 1200mg in 24 hours
* **Take with food** to minimize stomach upset

**Acetaminophen Dosage:**
* **Adults**: 500-1000mg every 4-6 hours as needed
* **Maximum**: 4000mg in 24 hours
* **Safe for most people**, including those with stomach issues

**Important Precautions:**
* **Do not exceed** recommended dosages
* **Avoid alcohol** while taking these medications
* **Consult your doctor** if you have liver or kidney problems
* **Stop taking** if you experience side effects

**Alternative Treatments:**
* **Rest and relaxation** techniques
* **Cold or warm compress** on forehead
* **Gentle neck and shoulder** stretches
* **Adequate hydration** and sleep`;
          
          const htmlResponse = marked.parse(response);
          appendMessage('bot', htmlResponse, true);
          updateStatus('‚úÖ Scenario 4 completed - Check complex formatting', 'success');
        }, 1000);
      }, 500);
    }

    function testMarkdownOnly() {
      clearChat();
      updateStatus('Testing Markdown Rendering Only', 'info');
      
      setTimeout(() => {
        const testMarkdown = `### **Patient Diagnosis / Current Status**

This is a test of the **problematic markdown** that was failing to render properly.

**Key Findings:**
* **Symptom**: Headache with pressure
* **Duration**: 24 hours
* **Severity**: Moderate

**Treatment Plan:**
1. **Immediate**: Rest and hydration
2. **Medication**: Ibuprofen 400mg
3. **Follow-up**: Monitor for 48 hours

*This should render with proper formatting including headings, bold text, and lists.*`;
        
        const htmlResponse = marked.parse(testMarkdown);
        appendMessage('bot', htmlResponse, true);
        updateStatus('‚úÖ Markdown test completed - Check if formatting works', 'success');
      }, 500);
    }

    function clearChat() {
      const messagesDiv = document.getElementById('chat-messages');
      messagesDiv.innerHTML = '<div class="message"><strong class="bot">DocBot:</strong><br/>Hi! I\'m your dedicated health assistant, here to support you with all your wellness questions. Feel free to ask me any question about your health and well-being.</div>';
    }

    function updateStatus(message, type) {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = message;
      statusDiv.className = `status ${type}`;
    }

    // Handle Enter key in textarea
    document.getElementById('user-input').addEventListener('keydown', function(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    });

    console.log('üß™ Medical Chatbot Conversation Test loaded successfully!');
    console.log('üìù Test scenarios available:');
    console.log('  - Scenario 1: Headache Diagnosis');
    console.log('  - Scenario 2: Chest Pain Assessment');
    console.log('  - Scenario 3: Follow-up Questions');
    console.log('  - Scenario 4: Complex Medical Response');
    console.log('  - Markdown Only: Test specific markdown rendering');
  </script>
</body>
</html>
